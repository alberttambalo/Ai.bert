!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ytSearch=t()}}(function(){return function a(o,l,s){function u(e,t){if(!l[e]){if(!o[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var i=l[e]={exports:{}};o[e][0].call(i.exports,function(t){return u(o[e][1][t]||t)},i,i.exports,a,o,l,s)}return l[e].exports}for(var c="function"==typeof require&&require,t=0;t<s.length;t++)u(s[t]);return u}({1:[function(u,t,e){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var E=u("cheerio"),c=u("dasu");u("async.parallellimit");c.follow=!1,c.debug=!1;var _=u("jsonpath"),p="Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html) (yt-search; https://www.npmjs.com/package/yt-search)",d=u("url"),r={};Object.keys(process.env).forEach(function(t){var e=process.env[t];if("0"==e||"false"==e||!e)return r[t]=!1;r[t]=e});var f=r.debug;function T(){f&&console.log.apply(this,arguments)}var n,N=u("querystring"),O=u("human-time"),P={YT:"https://youtube.com",SEARCH_MOBILE:"https://m.youtube.com/results",SEARCH_DESKTOP:"https://www.youtube.com/results"};function i(t,e){if(!e)return new Promise(function(r,n){i(t,function(t,e){if(t)return n(t);r(e)})});var r=void 0;if((r="string"==typeof t?{query:t}:t).userAgent&&(p=r.userAgent),r.search=r.query||r.search,r.original_search=r.search,r.videoId)return function(t,i){T("fn: getVideoMetaData");var e=void 0;"string"==typeof t&&(e=t);"object"===(void 0===t?"undefined":a(t))&&(e=t.videoId);var r="https://www.youtube.com/watch?hl=en&gl=US&v="+e,n=d.parse(r);n.headers={"user-agent":p},c.req(n,function(t,e,r){if(t)i(t);else{if(200!==e.status)return i("http status: "+e.status);if(f){var n=u("fs");u("path");n.writeFileSync("dasu.response",e.responseText,"utf8")}try{!function(t,e){T("_parseVideoInitialData");var n=/{.*}/,r=E.load(t),i="";if(!i)for(var a=r("script"),o=0;o<a.length;o++){var l=r(a[o]).html(),s=l.split("\n");s.forEach(function(t){for(var e=void 0;0<=(e=t.indexOf("ytInitialData"));){t=t.slice(e+"ytInitialData".length);var r=n.exec(t);r&&r.length>i.length&&(i=r)}})}if(!i)return e("could not find inital data in the html document");var u="";if(!u)for(var c=r("script"),p=0;p<c.length;p++){var d=r(c[p]).html(),f=d.split("\n");f.forEach(function(t){for(var e=void 0;0<=(e=t.indexOf("ytInitialPlayerResponse"));){t=t.slice(e+"ytInitialPlayerResponse".length);var r=n.exec(t);r&&r.length>u.length&&(u=r)}})}if(!u)return e("could not find inital player data in the html document");var v=JSON.parse(i[0]),h=JSON.parse(u[0]),m=_.value(v,"$..currentVideoEndpoint..videoId");if(!m)return e("video unavailable");if("ERROR"===_.value(h,"$..status")||"Video unavailable"===_.value(h,"$..reason"))return e("video unavailable");var y=_.value(v,"$..videoPrimaryInfoRenderer..title..text")||_.value(v,"$..videoPrimaryInfoRenderer..title..simpleText")||_.value(v,"$..videoPrimaryRenderer..title..text")||_.value(v,"$..videoPrimaryRenderer..title..simpleText")||_.value(v,"$..title..text")||_.value(v,"$..title..simpleText"),g=_.value(h,"$..description..text")||_.value(h,"$..description..simpleText")||_.value(v,"$..description..text")||_.value(v,"$..description..simpleText"),b=_.value(v,"$..owner..title..text")||_.value(v,"$..owner..title..simpleText"),x=_.value(v,"$..owner..navigationEndpoint..url")||_.value(v,"$..owner..title..url"),w="https://i.ytimg.com/vi/"+m+"/hqdefault.jpg",I=q(j(1e3*Number(_.value(h,"$..videoDetails..lengthSeconds")))),$=_.value(v,"$..sentimentBar..tooltip").split(/[,.]/).join("").split(/\D+/),S=(Number($[0]),Number($[1]),_.value(v,"$..dateText")),D={title:y,description:g,url:P.YT+"/watch?v="+m,videoId:m,seconds:Number(I.seconds),timestamp:I.timestamp,duration:I,views:Number(_.value(h,"$..videoDetails..viewCount")),genre:(_.value(h,"$..category")||"").toLowerCase(),uploadDate:_.value(h,"$..uploadDate"),ago:O(new Date(S)),image:w,thumbnail:w,author:{name:b,url:P.YT+x}};e(null,D)}(r,i)}catch(t){i(t)}}})}(r.videoId,e);if(r.listId)return function(t,i){T("fn: getPlaylistMetaData");var e=void 0;"string"==typeof t&&(e=t);"object"===(void 0===t?"undefined":a(t))&&(e=t.listId||t.playlistId);var r="https://www.youtube.com/playlist?hl=en&gl=US&list="+e,n=d.parse(r);n.headers={"user-agent":p},c.req(n,function(t,e,r){if(t)i(t);else{if(200!==e.status)return i("http status: "+e.status);if(f){var n=u("fs");u("path");n.writeFileSync("dasu.response",e.responseText,"utf8")}try{!function(t,e){T("fn: parsePlaylistBody"),console.log("parsePlaylistInitialData");var r=t.match(/ytInitialData.*=\s*({.*});/)[1];if(!r)throw new Error("failed to parse ytInitialData json data");var n=JSON.parse(r),i=_.value(n,"$..microformat..urlCanonical").split("=")[1];console.log("listId: "+i);var a=_.value(n,"$..sidebar.playlistSidebarRenderer.items[0]..stats[1].simpleText").match(/\d+/);console.log("viewCount: "+a);var o=_.query(n,"$..contents..tabs[0]..contents[0]..contents[0]..contents")[0],l=[];o.forEach(function(t){var e=t,r={title:_.value(e,"$..title..simpleText"),videoId:_.value(e,"$..videoId"),listId:i,thumbnail:_.value(e,"$..thumbnail..thumbnails[0]..url").split("?")[0],author:{name:_.value(e,"$..shortBylineText..runs[0]..text"),url:"https://youtube.com"+_.value(e,"$..shortBylineText..runs[0]..url")}};l.push(r)}),console.log(l),console.log("videos.length: "+l.length);var s={title:_.value(n,"$..microformat..title"),listId:i,url:"https://youtube.com/playlist?list="+i,views:Number(a),date:m(_.value(n,"$..sidebar.playlistSidebarRenderer.items[0]..stats[2]..simpleText")),image:l[0].thumbnail,thumbnail:l[0].thumbnail,videos:l,author:{name:_.value(n,"$..videoOwner..title..runs[0]..text"),url:"https://youtube.com"+_.value(n,"$..videoOwner..navigationEndpoint..url")}};e&&e(null,s)}(r,i)}catch(t){i(t)}}})}(r.listId,e);if(!r.search)return e(Error("yt-search: no query given"));!function m(y,g){var t=N.escape(y.search).split(/\s+/),e=y.hl||"en",r=y.gl||"US",n=y.category||"",i=Number(y.pageStart)||1,a=Number(y.pageEnd)||Number(y.pages)||1;i<=0&&(i=1)<=a&&(a+=1),Number.isNaN(a)&&g("error: pageEnd must be a number"),y.pageStart=i,y.pageEnd=a,y.currentPage=y.currentPage||i;var o="?";-1===(o+="search_query="+t.join("+")).indexOf("&hl=")&&(o+="&hl="+e),-1===o.indexOf("&gl=")&&(o+="&gl="+r),n&&(o+="&category="+n),y.sp&&(o+="&sp="+y.sp);var l=P.SEARCH_DESKTOP+o,s=d.parse(l);s.headers={"user-agent":p,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},T(s),T("getting results: "+y.currentPage),c.req(s,function(t,e,r){if(t)g(t);else{if(200!==e.status)return g("http status: "+e.status);if(f){var n=u("fs");u("path"),n.writeFileSync("dasu.response",e.responseText,"utf8")}try{v(r,function(t,e){if(t)return g(t);var r=e,n=r.filter(b),i=r.filter(x),a=r.filter(w);y._data=y._data||{},y._data.videos=y._data.videos||[],y._data.playlists=y._data.playlists||[],y._data.channels=y._data.channels||[],n.forEach(function(t){y._data.videos.push(t)}),i.forEach(function(t){y._data.playlists.push(t)}),a.forEach(function(t){y._data.channels.push(t)}),y.currentPage++;var o=y.currentPage<=y.pageEnd;if(o&&e._sp)y.sp=e._sp,setTimeout(function(){m(y,g)},1500);else{for(var l=y._data.videos.filter(b),s=y._data.playlists.filter(x),u=y._data.channels.filter(w),c=[],p=[],d=0;d<l.length;d++){var f=l[d];f.views<5?p.push(f):c.push(f)}for(var v=0;v<p.length;v++){var h=p[v];c.push(h)}g(null,{videos:c,playlists:s,lists:s,accounts:u,channels:u})}})}catch(t){g(t)}}})}(r,e)}function b(t,e,r){if("video"!==t.type)return!1;var n=t.videoId;return r.findIndex(function(t){return n===t.videoId})===e}function x(t,e,r){if("list"!==t.type)return!1;var n=t.listId;return r.findIndex(function(t){return n===t.listId})===e}function w(t,e,r){if("channel"!==t.type)return!1;var n=t.url;return r.findIndex(function(t){return n===t.url})===e}function v(t,e){var r=E.load(t),n=r("li .yt-lockup-tile"),i=[],a=[];try{var o=r("div.search-pager > button ~")[0];i._sp=o.attribs.href.split("&sp=")[1]}catch(t){T("next page results link not found")}for(var l=0;l<n.length;l++){var s=r(n[l]);try{var u=h(r,s);u&&i.push(u)}catch(t){a.push(t)}}e(a[0]||void 0,i)}function h(t,e){var r=t("a",e).attr("href")||"",n=N.parse(r.split("?",2)[1]);return n.list?function(t,e){var r=t(".yt-lockup-content",e),n=t(".yt-lockup-title",r),i=t("a",n),a=i.text().trim(),o=i.attr("href"),l=N.parse(o.split("?",2)[1]),s=l.list,u=l.v,c="",p="",d="",f="",v="",h="",m=t(".yt-lockup-byline",r),y=t("a",m),g=y.attr("href")||"";if(g)0<=g.indexOf("channel/")&&(c=g.split("/").pop(),p="https://youtube.com/channel/"+c,d=y.text().trim()),0<=g.indexOf("user/")&&(f=g.split("/").pop(),v="https://youtube.com/user/"+f,h=y.text().trim());else{var b=m.text().trim();h=b}var x=t(".sidebar",e).text().trim(),w=Number(x.replace(/\D+/g,"")),I=t("li.yt-lockup-playlist-item",r),$=t("a",I[0]).attr("href"),S=N.parse($.split("?",2)[1]).v,D=u||S,E="https://i.ytimg.com/vi/"+D+"/hqdefault.jpg";return{type:"list",title:a,url:"https://youtube.com/playlist?list="+s,listId:s,videoCountLabel:x,videoCount:w,image:E,thumbnail:E,author:{name:h||d,id:f||c,url:v||p,userId:f,userUrl:v,userName:h,channelId:c,channelUrl:p,channelName:d}}}(t,e):0===r.indexOf("/channel/")||0===r.indexOf("/user/")?function(t,e){var r="https:"+t("img",e).attr("src"),n=t(".yt-lockup-content",e),i=t(".yt-lockup-title",n),a=t("a",i),o=(a.text().trim(),a.attr("href")||""),l="",s="",u="",c="",p="",d="";0<=o.indexOf("channel/")&&(l=o.split("/").pop(),s="https://youtube.com/channel/"+l,u=a.text().trim());0<=o.indexOf("user/")&&(c=o.split("/").pop(),p="https://youtube.com/user/"+c,d=a.text().trim());var f=t(".yt-lockup-meta-info",n).text().trim(),v=Number(f.replace(/\D+/g,"")),h=t(".yt-lockup-description",n).text().trim();return m={type:"channel",title:d||u,description:h,url:p||s,videoCountLabel:f,videoCount:v,image:r,thumbnail:r,name:d||u,id:c||l},y="url",g=p||s,y in m?Object.defineProperty(m,y,{value:g,enumerable:!0,configurable:!0,writable:!0}):m[y]=g,m;var m,y,g}(t,e):n.v?function(t,e){var r=t(".yt-lockup-content",e),n=t(".yt-lockup-title",r),i=(t("img",e).src,t("a",n)),a=q(t("span",n).text()),o=i.attr("href")||"",l=N.parse(o.split("?",2)[1]).v,s=t(".yt-lockup-description",r).text().trim(),u=t(".yt-lockup-meta-info",r),c=t("li",u),p=t(c[0]).text(),d=t(c[1]).text(),f=Number(d.split(" ")[0].split(",").join("").trim()),v="",h="",m="",y="",g=t('a[href^="/user/"]',r);g&&(m=(g.attr("href")||"").replace("/user/","").trim(),y=g.text().trim());var b=t('a[href^="/channel/"]',r);b&&(v=(b.attr("href")||"").replace("/channel/","").trim(),h=b.text().trim());v&&"https://youtube.com/channel/"+v;m&&"https://youtube.com/user/"+m;var x="https://i.ytimg.com/vi/"+l+"/hqdefault.jpg";return{type:"video",title:i.text().trim(),description:s,url:"https://youtube.com/watch?v="+l,videoId:l,seconds:Number(a.seconds),timestamp:a.timestamp,duration:a,views:Number(f),image:x,thumbnail:x,ago:p,author:{name:y||h,url:g.attr("href")||b.attr("href")}}}(t,e):void 0}function q(t){var e=t.split(/\s+/),r=e[e.length-1].replace(/[^:.\d]/g,"");if(!r)return{toString:function(){return e[0]},seconds:0,timestamp:0};for(;r[r.length-1].match(/\D/);)r=r.slice(0,-1);for(var n=(r=r.replace(/\./g,":")).split(/[:.]/),i=0,a=0,o=n.length-1;0<=o;o--)if(!(n[o].length<=0)){var l=n[o].replace(/\D/g,"");if(i+=parseInt(l)*(0<a?Math.pow(60,a):1),2<++a)break}return{toString:function(){return i+" seconds ("+r+")"},seconds:i,timestamp:r}}function j(t){var e="",r=Math.floor(t/36e5),n=Math.floor(t/6e4)%60,i=Math.floor(t/1e3)%60;return r&&(e+=r+":"),n&&(e+=n+":"),String(i).length<2&&(e+="0"),e+=i}function m(t){T("fn: _parsePlaylistLastUpdateTime");for(var e=t.trim().split(/[\s.-]+/),r=0;r<e.length;r++){var n=e.slice(r),i=n.join(" "),a=n.reverse().join(" "),o=new Date(i),l=new Date(a);if("Invalid Date"!==o.toString())return s(o);if("Invalid Date"!==l.toString())return s(l)}return""}function s(t){return T("fn: _toInternalDateString"),t.getUTCFullYear()+"-"+t.getUTCMonth()+"-"+t.getUTCDate()}t.exports=function(t,e){return i(t,e)},t.exports.search=i,u.main===t&&(n="superman theme list pewdiepie channel",console.log("test: doing list search"),i({query:n,pageEnd:1},function(t,e){if(t)throw t;var r=e.videos,n=e.playlists,i=e.channels;console.log("videos: "+r.length),console.log("playlists: "+n.length),console.log("channels: "+i.length);for(var a=0;a<r.length;a++){var o=r[a],l=" ("+o.timestamp+")";console.log(o.title+l)}n.forEach(function(t){console.log("playlist: "+t.title+" | "+t.listId)}),i.forEach(function(t){console.log("channel: "+t.title+" | "+t.description)})}))},{"async.parallellimit":void 0,cheerio:void 0,dasu:void 0,fs:void 0,"human-time":void 0,jsonpath:void 0,path:void 0,querystring:void 0,url:void 0}]},{},[1])(1)});